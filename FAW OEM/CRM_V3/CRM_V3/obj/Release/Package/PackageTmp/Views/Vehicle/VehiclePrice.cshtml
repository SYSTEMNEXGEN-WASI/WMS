
@{
    ViewBag.Title = "VehiclePrice";
    Layout = "~/Views/Shared/_LayoutV2.cshtml";
}

<h2>VehiclePrice</h2>

<style>
    .makespace {
        margin-bottom: 20px;
    }

    .icheckbox_minimal-blue {
        top: 10px;
    }
</style>
<section class="wrapper main-wrapper row">
    <form method="post">
        <div class="col-xs-12">
            <section class="box">
                <header class="panel_header">
                    <h2 class="title pull-left">Vehicle Price Details</h2>
                    <div class="actions panel_actions pull-right">
                        <a class="box_toggle fa fa-chevron-down"></a>
                    </div>
                </header>
                <div class="content-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">Vehicle Id</label>
                            <div class="input-group">
                                <span class="input-group-addon"><a id="IssueClick" onclick="ShowModal('Vehicle')" style="color:blue"><i class="fa fa-search"></i></a></span>
                                <input type="text" class="form-control" id="ddlVehicle" readonly>
                                @*@Html.DropDownList("ddlVehicle", new SelectList((IEnumerable<SelectListItem>)ViewBag.Vehicle, "Value", "Text", "0"), new { @class = "form-control m-bot15", @id = "ddlVehicle" })*@
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Made/Brand</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-tags"></i></span>
                                @Html.DropDownList("ddlmade", new SelectList((IEnumerable<SelectListItem>)ViewBag.Made, "Value", "Text", "0"), new { @class = "form-control m-bot15", @id = "ddlmade" })
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Product Title</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-tasks"></i></span>
                                <input type="text" class="form-control" id="txtProdTitle" readonly maxlength="50">
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Product Code</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-barcode"></i></span>
                                <input type="text" class="form-control" id="txtProdCode" readonly maxlength="10">
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Model/Version Code</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-barcode"></i></span>
                                @Html.DropDownList("txtVersionCode", new SelectList((IEnumerable<SelectListItem>)ViewBag.ddlVersion, "Value", "Text", "0"), new { @class = "form-control m-bot15", style = "border-radius:0px;", @id = "txtVersionCode" })
                                @*<input type="text" class="form-control" maxlength="3" readonly id="txtVersionCode">*@
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Vehicle Description</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-file-text-o"></i></span>
                                <input type="text" class="form-control" id="txtShortDesc" readonly maxlength="30">
                            </div>
                            <div class="makespace"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">

                            <ul class="nav nav-tabs primary" style="border-radius:0px;">
                                @*<li class="active">
                                        <a href="#tabVehDetails" data-toggle="tab" style="border-radius:0px;">
                                            <i class="fa fa-car"></i> Vehicle Details
                                        </a>
                                    </li>*@
                                <li class="active">
                                    <a href="#tabVehPrice" data-toggle="tab" style="border-radius:0px;">
                                        <i class="fa fa-car"></i> Vehicle Price
                                    </a>
                                </li>

                                @*<li>
                                        <a href="#tabAccCodeSetup" data-toggle="tab">
                                            <i class="fa fa-event"></i> Account Code Setup
                                        </a>
                                    </li>*@
                                @* <li>
                                        <a href="#settings-7" data-toggle="tab">
                                            <i class="fa fa-car"></i> Vehicle Location
                                        </a>
                                    </li>*@
                            </ul>

                            <div class="tab-content primary">
                                @*<div class="tab-pane fade in active" id="tabVehDetails">

                                    </div>*@
                                <div class="tab-pane fade  in active" id="tabVehPrice">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label class="form-label">Color</label>
                                            <div class="input-group">
                                                <span class="input-group-addon"><i class="fa fa-pie-chart"></i></span>
                                                @Html.DropDownList("ddlColor", new SelectList((IEnumerable<SelectListItem>)ViewBag.Color, "Value", "Text", "0"), new { @class = "form-control m-bot15", @id = "ddlColor" })
                                            </div>
                                            <div class="makespace"></div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Basic Price</label>
                                            <div class="input-group">
                                                <span class="input-group-addon"><i class="fa fa-money"></i></span>
                                                <input type="text" class="form-control" id="txtSalePrice" maxlength="9" onkeypress="return isNumberKey(event)" />
                                            </div>
                                            <div class="makespace"></div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Cost Price</label>
                                            <div class="input-group">
                                                <span class="input-group-addon"><i class="fa fa-money"></i></span>
                                                <input type="text" class="form-control" id="txtCostPrice" maxlength="9" onkeypress="return isNumberKey(event)" />
                                            </div>
                                            <div class="makespace"></div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">With Holding Tax (%)</label>
                                            <div class="input-group">
                                                <span class="input-group-addon"><i class="fa fa-money"></i></span>
                                                <input type="text" class="form-control" id="txtWHTax" maxlength="5" onkeypress="return isNumberKey(event)" />
                                            </div>
                                            <div class="makespace"></div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Furthur Tax (%)</label>
                                            <div class="input-group">
                                                <span class="input-group-addon"><i class="fa fa-money"></i></span>
                                                <input type="text" class="form-control" id="txtFurTax" maxlength="5" onkeypress="return isNumberKey(event)" />
                                            </div>
                                            <div class="makespace"></div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Extra Tax (%)</label>
                                            <div class="input-group">
                                                <span class="input-group-addon"><i class="fa fa-money"></i></span>
                                                <input type="text" class="form-control" id="txtExTax" maxlength="5" onkeypress="return isNumberKey(event)" />
                                            </div>
                                            <div class="makespace"></div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Registered Type</label>
                                            <div class="input-group">
                                                <span class="input-group-addon"><i class="fa fa-money"></i></span>
                                                <select class="form-control m-bot15" id="ddlRegType" name="CusTitle">
                                                    <option value="FILER">Filer</option>
                                                    <option value="NON FILER">Non-Filer</option>
                                                    <option value="EXEMPTED">Exempted</option>
                                                </select>
                                            </div>
                                            <div class="makespace"></div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Register Tax (%)</label>
                                            <div class="input-group">
                                                <span class="input-group-addon"><i class="fa fa-money"></i></span>
                                                <input type="text" class="form-control" id="txtRegTax" maxlength="5" onkeypress="return isNumberKey(event)" />
                                            </div>
                                            <div class="makespace"></div>
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">Active</label>
                                            <div class="input-group">
                                                <input type="checkbox" id="chkActive" value="Y" class="icheckbox_minimal-white" />
                                            </div>
                                            <div class="makespace"></div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="input-group" style="width:100%;margin-top: 28px;">
                                                <button class="btn btn-success btn-sm" type="button" style="width: 100%;padding: 8px;" onclick="AddVehicleDetail(this)">
                                                    <i class="fa fa-plus fa-2x"></i>
                                                </button>
                                            </div>
                                            <div class="makespace"></div>
                                        </div>

                                    </div>
                                    <div class="row" style="margin-top:1rem;">
                                        <div class="col-md-12">
                                            <div class="table-responsive">
                                                <table class="table table-bordered table-striped" id="VehicleDetail" style="white-space: nowrap; FONT-SIZE: 13px;">
                                                    <thead>
                                                        <tr>
                                                            <th>SN #</th>
                                                            <th>Color</th>
                                                            <th>Basic Price</th>
                                                            <th>Cost Price</th>
                                                            <th>WHTax</th>
                                                            <th>Fur Tax</th>
                                                            <th>Extra Tax</th>
                                                            <th>Reg Type</th>
                                                            <th>Reg Tax</th>
                                                            <th>Active</th>
                                                            @*<th>Status</th>

                                                                <th>Sale Price</th>*@
                                                            <th>Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="tab-pane fade" id="tabAccCodeSetup">


                                </div>

                            </div>

                        </div>
                    </div>

                    <div class="row">
                        <div class="pull-right">

                            <div class="pull-right">
                                <button type="reset" class="btn btn-default" id="btnCancel" style="margin-top:25px;width:100px;border-radius:0px;">Clear</button>
                                <button type="button" class="btn btn-primary" id="btnSave" style="margin-top:25px;width:100px; border-radius:0px;">Save</button>
                                <button type="button" class="btn btn-danger" id="btnDelete" style="margin-top:25px;width:100px; border-radius:0px;" disabled>Delete</button>
                            </div>

                        </div>
                    </div>
                </div>


            </section>
        </div>

    </form>

    <!-- Popup box modal start -->
    <div class="modal" id="section-confirm" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog animated bounceInDown">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Confirm</h4>
                </div>
                <div class="modal-body">

                    <h5>Are you sure want to save ?</h5>

                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button">No</button>
                    <button class="btn btn-primary" type="button" onclick="saveVehTaxDetail()">Yes</button>
                </div>
            </div>
        </div>
    </div>
    <!-- modal end -->
    <!-- modal end -->
    <!-- Bank modal start -->
    <!-- modal end -->
    <!-- Bank modal start -->
    <!-- modal end -->
    <!-- Bank modal start -->
    <!-- modal end -->
    <!-- Popup box modal start -->
    <div class="modal" id="section-message" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog animated bounceInDown">
            <div class="modal-content">
                <div class="modal-header" id="modalMessage">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Message</h4>
                </div>
                <div class="modal-body">

                    <h5 id="lblMessage"></h5>

                </div>
                <div class="modal-footer">
                    @*<button data-dismiss="modal" class="btn btn-default" type="button" onclick="location.reload()">Close</button>*@
                    <button type="button" style="text-transform: uppercase;" class="btn btn-danger waves-effect text-left" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- modal end -->
    <!-- Enquiry No Modal Start -->
    <div class="modal" tabindex="-1" id="VehicleModal" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="margin-top:60px;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="modal123Label">Vehicles</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group row">
                        <label for="exampleInputuname" class="col-md-2">Search :</label>
                        <div class="col-md-10">
                            <input type="text" id="txtVehicleSearch" class="form-control" aria-controls="VehicleTable" placeholder="Search . . . ">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="table-responsive" style="height:300px;">
                            <table id="VehicleTable" class="table table-striped table-hover responsive">
                                <thead>
                                    <tr>
                                        <th>Sr</th>
                                        <th>Vehicle Code</th>
                                        <th>Brand</th>
                                        <th>Product</th>
                                        <th>Version</th>
                                    </tr>
                                </thead>
                                <tbody style="font-size:12px; text-transform: uppercase">
                                    @{ int i = 1; }
                                    @if (ViewBag.Vehicles != null)
                                    {

                                        foreach (var item in ViewBag.Vehicles)
                                        {
                                            <tr style="text-align: left" onclick="RevClickDetail('@item.VehicleCode')">
                                                <td> @i</td> @{ i++; }
                                                <td class="tdDiv">
                                                    <a href="#" style="color:black">@item.VehicleCode</a>
                                                </td>
                                                <td class="tdDiv">
                                                    <a href="#" style="color:black">@item.BrandCode</a>
                                                </td>
                                                <td class="tdDiv">
                                                    <a href="#" style="color:black">@item.ProdDesc</a>
                                                </td>
                                                <td class="tdDiv">
                                                    <a href="#" style="color:black">@item.VersionDesc</a>
                                                </td>
                                                @*<td class="tdDiv">
                                                    <a href="#" style="color:black">@item.CostPrice</a>
                                                </td>
                                                <td class="tdDiv">
                                                    <a href="#" style="color:black">@item.SalePrice</a>
                                                </td>*@
                                            </tr>
                                                        }
                                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
               
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- Enquiry No Modal End -->
    <!-- MAIN CONTENT AREA ENDS -->

</section>
<script src='@Url.Content("~/assets/js/jquery-1.11.2.min.js")' type="text/javascript"></script>

<script type="text/javascript">

    $(document).ready(function () {
       
        document.getElementById("txtVersionCode").disabled = true;
        document.getElementById("ddlmade").disabled = true;
        $("#txtVehicleSearch").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#VehicleTable tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });



    $("#btnSave").click(function () {
        if (!PageValidation()) {
            return false;
        }
        $("#section-confirm").modal("show");

    })

    function PageValidation() {

        debugger;
        var count = 0;

        if ($("#ddlmade").val() == '0' || $("#ddlmade").val() == null) {
            $("#ddlmade").css("border-color", "red");
            $("#ddlmade").focus();
            count++;
        }
        if ($("#txtProdCode").val() == '' || $("#txtProdCode").val() == null) {
            $("#txtProdCode").css("border-color", "red");
            $("#txtProdCode").focus();
            count++;
        }
        if ($("#txtVersionCode").val() == '' || $("#txtVersionCode").val() == null) {
            $("#txtVersionCode").css("border-color", "red");
            $("#txtVersionCode").focus();
            count++;
        }
        if ($("#ddlSegment").val() == "0") {
            $("#ddlSegment").css("border-color", "red");
            $("#ddlSegment").focus();
            count++;
        }
        //if ($("#txtAccCode").val() == '') {
        //    $("#txtAccCode").css("border-color", "red");
        //    $("#txtAccCode").focus();
        //    count++;
        //}
        //if ($("#txtAccDesc").val() == '') {
        //    $("#txtAccDesc").css("border-color", "red");
        //    $("#txtAccCode").focus();
        //    count++;
        //}
        //if (ValidateColorDetails() == false) {

        //    count++;

        //}
        if (count > 0) {

            $("#lblMessage").html("Please fill the Required feilds");
            $("#section-message").modal("show");
            return false;
        }
        else {
            return true;
        }

    }

    function ShowModal(type) {
        if (type == "Vehicle") {

            $('#VehicleModal').modal("show");
        }
        //else if (type == "") {
        //    $('#AccountModal').modal("show");
        //}
        //else if (type == "") {
        //    $('#AccountModalCostofSale').modal("show");
        //}
        //else {
        //    $('#AccountRevenueModal').modal("show");

        //}

    }
    $("#txtVersionCode").change(function () {
        debugger;
        var leadId = $("#txtVersionCode").val();
        $.ajax({
            dataType: "json",
            async: true,
            type: 'GET',
            url: '@Url.Content("~/Vehicle/Get_veh_Data")',
            data: { 'EnquiryId': leadId },
            success: function (data) {


                    debugger;
                    //Event Information
                    if (leadId == data[0].VersionCode) {
                        $("#modalMessage").css("background-color", "#e46457");
                        $("#lblMessage").text("Version  Is Already Exist It Should be Unique")
                        $("#section-message").modal('show');
                        return false;
                    }



            },
            complete: function () {

            },
        });



    })
    $("#chkFSC").change(function () {
        debugger
        var FFS = $("#chkFSC").is(":checked");
        if (FFS) {
            $("#txtPDI").prop('disabled', false);
            $("#txtFFS").prop('disabled', false);
            $("#txtSFS").prop('disabled', false);
            $("#txtTFS").prop('disabled', false);


        } else {
            $("#txtPDI").prop('disabled', true);
            $("#txtFFS").prop('disabled', true);
            $("#txtSFS").prop('disabled', true);
            $("#txtTFS").prop('disabled', true);
        }

    })

    function isNumberKey(evt) {
        var charCode = (evt.which) ? evt.which : event.keyCode
        if (charCode > 31 && (charCode < 48 || charCode > 57))
            return false;
        return true;
    }

    var rowCount = 1;
    var dataCount = 1;
    var SNo = 1;


    function ValidateColorDetails() {
        debugger

        var check = true;


        var x = document.getElementById("VehicleDetail").rows.length;

        if (x ==1) {
            $("#section-Grid").modal("show");
            return check=false;
        }




        return check;
    }

    function AddVehicleDetail(value) {


        var SalePrice = $("#txtSalePrice").val();
        var CostPrice = $("#txtCostPrice").val();


        if ($.trim(SalePrice) == "" || SalePrice == undefined||SalePrice==null) {
            $("#txtSalePrice").css("border-color", "red");
            SalePrice = 0;
            return check;
        } else {
            $("#txtSalePrice").css("border-color", "#ccc");
        }

        if ($.trim(CostPrice) == "" || CostPrice == undefined || CostPrice == null) {
            $("#txtCostPrice").css("border-color", "red");
            CostPrice = 0;
            return check;
        } else {
            $("#txtCostPrice").css("border-color", "#ccc");
        }
        //var check = true;
        var check = ValidateColorDetails();
        debugger


            var colorCode = $("#ddlColor").val();
            var colorDesc = $("#ddlColor :selected").text();

            var salePrice = $("#txtSalePrice").val();
            if ($.trim(SalePrice) == "" || SalePrice == undefined || SalePrice == null) {

                SalePrice = 0;

            }
            var CostPrice = $("#txtCostPrice").val();
            if ($.trim(CostPrice) == "" || CostPrice == undefined || CostPrice == null) {

                CostPrice = 0;

            }
            var WHTax = $("#txtWHTax").val();
            if ($.trim(WHTax) == "" || WHTax == undefined || WHTax == null) {

                WHTax = 0;

            }
            var FurTax = $("#txtFurTax").val();
            if ($.trim(FurTax) == "" || FurTax == undefined || FurTax == null) {

                FurTax = 0;

            }
            var exTax = $("#txtExTax").val();
            if ($.trim(exTax) == "" || exTax == undefined || exTax == null) {

                exTax = 0;

            }
            var RegType =   $("#ddlRegType").val();
            var RegTax = $("#txtRegTax").val();
            if ($.trim(RegTax) == "" || RegTax == undefined || RegTax == null) {

                RegTax = 0;

            }

            var chkActive = $("#chkActive").is(":checked");

            if (chkActive)
                chkActive = 'Y';
            else
                chkActive = 'N'

            var row = $(value).parent().parent().html();
            var dt = $("#VehicleDetail tbody").append('<tr id="fixedRow' + (rowCount++) + '" data-tr-count="' + (dataCount++) + '">' +
                                                        '<td>' + SNo++ + '</td>' +
                                                        '<td> <label id="lblColor">' + colorDesc + ' </label><input type="hidden" id="hdnColorCode" value="' + colorCode + '"/></td>' +
                                                        '<td> <label id="lblSalePrice">' + salePrice + ' </label></td>' +
                                                        '<td> <label id="lblCostPrice">' + CostPrice + ' </label></td>' +
                                                        '<td> <label id="lblWHTax">' + WHTax + ' </label></td>' +
                                                        '<td> <label id="lblFurTax">' + FurTax + ' </label></td>' +
                                                        '<td> <label id="lblExTax">' + exTax + ' </label></td>' +
                                                        '<td> <label id="lblRegType">' + RegType + ' </label></td>' +
                                                        '<td> <label id="lblRegTax">' + RegTax + ' </label></td>' +
                                                        '<td> <label id="lblChkActive">' + chkActive + ' </label></td>' +
                                                        '</td><td style="text-align:left"><a class="selectItem"><i class="fa fa-edit" style="color:blue"></i></a>&nbsp;&nbsp;|&nbsp;&nbsp;<a class= "deleteItem" style="color:blue" ><i class="fa fa-trash"></i></a></td></tr>');
            ClearFeildtable();


    }

    @*function EditTable() {
        var DealerCode
        var VehicleCode
        var BrandCode    ="";
        var ProdCode     ="";
        var VersionCode  ="";
        var ColorCode    ="";
        var SalePrice    ="";
        var VehicleStatus="";
        var CostPrice    ="";
        var WHTaxPerc    ="";
        var FurTaxPerc   ="";
        var ExtraTaxPerc ="";
        var RegType      ="";
        var RegTaxPerc   ="";
        var IsActive = "";

        $("#VehicleDetail tbody tr").each(function () {

            debugger
           // var dto = {};

          //  DealerCode    = "@Session["DealerCode"].ToString()";
           // VehicleCode   = $("#ddlVehicle").val();
            //  $("#ddlmade").val()                                       =BrandCode  ;
            // $("#txtProdCode").val()                                        =ProdCode  ;
            // $("#txtVersionCode").val()                                    =VersionCode  ;
            $(this).closest('tr').find('#lblColor').val() = ColorCode;
             $(this).closest('tr').find('#lblSalePrice').text()             =SalePrice   ;
             $("#ddlVehStatus").val()                                      =VehicleStatus;
             $(this).closest('tr').find('#lblCostPrice').text()             =CostPrice    ;
             $(this).closest('tr').find('#lblWHTax').text()                =WHTaxPerc    ;
             $(this).closest('tr').find('#lblFurTax').text().trim()         =FurTaxPerc   ;
             $(this).closest('tr').find('#lblExTax').text().trim()          =ExtraTaxPerc ;
             $(this).closest('tr').find('#lblRegType').text().trim()        =RegType     ;
             $(this).closest('tr').find('#lblRegTax').text()                =RegTaxPerc   ;
             $(this).closest('tr').find('#chkActive').val()                =IsActive     ;

           // obj.push(dto);

        });

        $("#ddlColor").val("");
        //$("#ddlColor :selected").text();




    }*@

    function ClearFeildtable(){
        $("#ddlColor").val("");
        //$("#ddlColor :selected").text();

        $("#txtSalePrice").val("");
        $("#txtCostPrice").val("");
        $("#txtWHTax").val("");
        $("#txtFurTax").val("");
        $("#txtExTax").val("");
        $("#ddlRegType").val("");
        $("#txtRegTax").val("");

        $("#chkActive").is(":unchecked");



    }

    //$("#btnSave").click(function () {

    //    //var check = true;
    //    var check = ValidateColorDetails();
    //    if (check == true) {
    //        $("#section-confirm").modal("show");
    //    }
    //})
    function SaveEnquiry() {
        debugger


            var dto = {};


        dto.DealerCode = "@Session["DealerCode"].ToString()";
        dto.VehicleCode = $("#ddlVehicle").val();
        dto.BrandCode = $("#ddlmade").val();
        dto.ProdTitle = $("#txtProdTitle").val();
        dto.ProdCode = $("#txtProdCode").val();
        dto.VersionCode = $("#txtVersionCode").val();
        dto.ProdDesc = $("#txtShortDesc").val();
        dto.ColorCode = $("#ddlVehColor").val();
        dto.Color = $("#ddlColor :selected").text();
        dto.ProdLongDesc = $("#txtLongDesc").val();
        dto.VehTypeCode = $("#ddlVehicleType").val();
        dto.Seater = $("#txtSeater").val();
        dto.Compartment = $("#txtCompartment").val();
        dto.Weight = $("#txtWeight").val();
        dto.Power = $("#txtEngCapacity").val();
        dto.VehiclePrefix = $("#txtVehPrefix").val();
        if($("#ddlFuelType").val() == 'CNG'){
            dto.CNGFlag = 'Y'
        }else{
            dto.CNGFlag = 'N'
        }

        dto.SchedulePlan = $("#txtSchPlan").val();
        dto.TransmissionType = $("#ddlTransType").val();
        dto.Segment = $("#ddlSegment").val();
        dto.MSPR = $("#txtMSPR").val();
        dto.VehicleCategory = $("#txtVehCategory").val();
        dto.VehicleStatus = $("#ddlVehStatus").val();
        dto.Remarks = $("#txtRemarks").val();

        var FFS = $("#chkFSC").is(":checked");
        var Active = $("#chkVehActive").is(":checked");
        //var VehDummy = $("#chkVehDummy").is(":checked");

        if (FFS) {
            dto.FreeServiceCup = "Y";
            dto.FFS = $("#txtFFS").val();
            dto.PDI = $("#txtPDI").val();
            dto.SFS = $("#txtSFS").val();
            dto.TFS = $("#txtTFS").val();
        }else{
            dto.FreeServiceCup = "N";
        }

        if (Active) {
            dto.isActive = "Y";
        }else{
            dto.isActive = "N";
        }

        dto.VehicleStock = $("#txtAccCode").val();
        dto.CostofSale = $("#txtCoseofSaleCode").val();
        dto.Revenue = $("#txtRevenueCode").val();
        dto.OwnMoney = $("#txtOwnMoneyC").val();
        dto.DownMoney = $("#txtDownMoneyC").val();

        if ($("#ddlVehicle").val() == "") {
            $.ajax({
                dataType: "json",
                async: true,
                type: 'GET',
                url: '@Url.Content("~/Vehicle/Insert_VehicleMaster")',
                data: dto,
                success: function (data) {
                    debugger
                    if (data) {
                        if (data.Success == true) {

                            if ($("#VehicleDetail tbody tr").length > 0) {
                                saveVehTaxDetail();
                            }

                            $("#section-confirm").modal("hide")
                            $("#modalMessage").css("background-color", "#64c344");
                            $("#lblMessage").text(data.Message)
                            $("#section-message").modal('show');
                            setTimeout(function () {
                                $('#section-message').modal('hide')
                            }, 4000);
                        }
                        else {
                            $("#section-confirm").modal("hide")
                            $("#modalMessage").css("background-color", "#e46457");
                            $("#lblMessage").text(data.Message)
                            $("#section-message").modal('show');
                        }
                    }
                },
                complete: function () {

                },
                error: function (data) {
                    $("#section-confirm").modal("hide")
                    $("#modalMessage").css("background-color", "#e46457");
                    $("#lblMessage").text(data.Message)
                    $("#section-message").modal('show');
                }
            });

        }
        else {
            $.ajax({
                dataType: "json",
                async: true,
                type: 'GET',
                url: '@Url.Content("~/Vehicle/Insert_VehicleMaster")',
                data: dto,
                success: function (data) {
                    debugger
                    if (data) {
                        if (data.Success == true) {

                            //if ($("#VehicleDetail tbody tr").length > 0) {
                            //  //  saveVehTaxDetail();
                            //}

                            $("#section-confirm").modal("hide")
                            $("#modalMessage").css("background-color", "#64c344");
                            $("#lblMessage").text(data.Message)
                            $("#section-message").modal('show');
                            setTimeout(function () {
                                $('#section-message').modal('hide')
                                location.reload();
                            }, 3000);
                        }
                        else {
                            $("#section-confirm").modal("hide")
                            $("#modalMessage").css("background-color", "#e46457");
                            $("#lblMessage").text(data.Message)
                            $("#section-message").modal('show');
                            setTimeout(function () {
                                $('#section-message').modal('hide')
                                location.reload();
                            }, 4000);
                        }
                    }
                },
                complete: function () {

                },
                error: function (data) {
                    $("#section-confirm").modal("hide")
                    $("#modalMessage").css("background-color", "#e46457");
                    $("#lblMessage").text(data.Message)
                    $("#section-message").modal('show');
                }
            });



        }
    }

    function insertRecord() {
        var obj = [];

        $("#VehicleDetail tbody tr").each(function () {

            debugger
            var dto = {};

            dto.DealerCode = "COMON";
            dto.VehicleCode = $("#ddlVehicle").val();
            dto.BrandCode = $("#ddlmade").val();
            dto.ProdCode = $("#txtProdCode").val();
            dto.VersionCode = $("#txtVersionCode").val();
            dto.ColorCode = $(this).closest('tr').find('#hdnColorCode').val();
            dto.SalePrice = $(this).closest('tr').find('#lblSalePrice').text();
            dto.VehicleStatus = $("#ddlVehStatus").val();
            dto.CostPrice = $(this).closest('tr').find('#lblCostPrice').text();
            dto.WHTaxPerc = $(this).closest('tr').find('#lblWHTax').text();
            dto.FurTaxPerc = $(this).closest('tr').find('#lblFurTax').text().trim();
            dto.ExtraTaxPerc = $(this).closest('tr').find('#lblExTax').text().trim();
            dto.RegType = $(this).closest('tr').find('#lblRegType').text().trim();
            dto.RegTaxPerc = $(this).closest('tr').find('#lblRegTax').text();
            dto.IsActive = $(this).closest('tr').find('#chkActive').val();
            dto.VehicleCategory = "@Session["VehicleCategory"].ToString()";
            obj.push(dto);

        });

        return obj;
    }

    function saveVehTaxDetail() {

        var objects = [];
    debugger
        objects = JSON.stringify({ 'objects' : insertRecord()});

        $.ajax({
            contentType: 'application/json; charset=utf-8',
            dataType: "json",
            //async: true,
            type: 'POST',
            url: '@Url.Content("~/Vehicle/Insert_VehicleTaxDetail")',
            data: objects ,
            success: function (data) {

                if (data) {
                    if (data.Success == true) {
                        $("#section-confirm").modal("hide")
                        $("#modalMessage").css("background-color", "#64c344");
                        $("#lblMessage").text(data.Message)
                        $("#section-message").modal('show');
                        setTimeout(function () {
                            $('#section-message').modal('hide')
                            location.reload();
                        }, 4000);
                    }
                    else {
                        $("#section-confirm").modal("hide")
                        $("#modalMessage").css("background-color", "#e46457");
                        $("#lblMessage").text(data.Message)
                        $("#section-message").modal('show');
                    }
                }
            },
            complete: function () {

            },
            error: function (data) {
                $("#section-confirm").modal("hide")
                $("#modalMessage").css("background-color", "#e46457");
                $("#lblMessage").text(data.Message)
                $("#section-message").modal('show');
            }

        });
    }

    //$("#ddlVehicle").change(function () {
    //    var leadId = $("#ddlVehicle").val();
    //    if (leadId == "0") {
    //        location.reload();
    //    }
    //    else {
    //        getData(leadId);
    //        document.getElementById("btnDelete").disabled = false;
    //    }
    //});

    function RevClickDetail(leadId) {
        $("#ddlVehicle").val(leadId);
            getData(leadId);
            document.getElementById("btnDelete").disabled = false;
    }

    function getData(id) {
        var leadId = id;
        if (leadId != "0") {
            $.ajax({
                dataType: "json",
                async: true,
                type: 'GET',
                url: '@Url.Content("~/Vehicle/Select_Vehicle")',
                data: { 'EnquiryId': leadId},
                success: function (data) {
                    if (data.Success == true) {
                        var item = JSON.parse(data.Response)
                        debugger
                        //Event Information

                        $("#ddlmade").val(item[0].BrandCode);
                        $("#txtProdTitle").val(item[0].ProdTitle);
                        $("#txtProdCode").val(item[0].ProdCode);
                        $("#txtVersionCode").val(item[0].VersionCode);
                        $("#txtShortDesc").val(item[0].ProdDesc);
                        $("#ddlVehColor").val(item[0].ColorCode);
                       // $("#ddlVehColor").text(item[0].Color);
                        $("#ddlColor").val(item[0].ColorCode);
                        $("#txtLongDesc").val(item[0].ProdLongDesc);
                        $("#ddlVehicleType").val(item[0].VehTypeCode);
                        $("#txtSeater").val(item[0].Seater);
                        $("#txtCompartment").val(item[0].Compartment);
                        $("#txtWeight").val(item[0].Weight);
                        $("#txtEngCapacity").val(item[0].Power);
                        $("#txtVehPrefix").val(item[0].VehiclePrefix);
                        $("#ddlFuelType").val(item[0].CNGFlag);
                        $("#txtSchPlan").val(item[0].SchedulePlan);
                        $("#ddlTransType").val(item[0].TransmissionType);
                        $("#ddlSegment").val(item[0].Segment);
                        $("#txtMSPR").val(item[0].MSPR);
                        $("#ddlVehStatus").val(item[0].VehicleStatus);
                        $("#txtRemarks").val(item[0].Remarks);
                        $("#txtAccCode").val(item[0].VehicleStock);
                        $("#txtCoseofSaleCode").val(item[0].CostofSale);
                        $("#txtRevenueCode").val(item[0].Revenue);
                        $("#txtOwnMoneyC").val(item[0].OwnMoney);
                        $("#txtDownMoneyC").val(item[0].DownMoney);
                        if(item[0].isActive == "Y"){
                            $("#chkVehActive").prop('checked',true);
                        }else
                            $('#chkVehActive').prop('checked', false);
                        debugger;
                        getVehicleData(id, item[0].BrandCode, item[0].VersionCode, item[0].ProdCode);
                        //getCategory(item[0].VehTypeCode);
                    }
                },
                complete: function () {

                },
            });

        }

    }

    function getVehicleData(id,brandCode,VersionCode,ProdCode) {
        var rowCount1 = 1;
        var dataCount1 = 1;
        var SNo1 = 1;


        var leadId = id;
        if (leadId != "0") {
            $.ajax({
                dataType: "json",
                async: true,
                type: 'GET',
                url: '@Url.Content("~/Vehicle/Select_VehicleDetail")',
                data: { 'EnquiryId': leadId },
                success: function (data) {
                    debugger;
                    if (data.Success == true) {
                        var item = JSON.parse(data.Response)
                        $("#VehicleDetail tbody tr").remove()
                        //ProductDetail
                        if (item.length > 0) {
                            $.each(item, function (value, item) {
                                $("#VehicleDetail tbody").append('<tr id="fixedRow' + (rowCount1++) + '" data-tr-count="' + (dataCount1++) + '">' +
                                                        '<td>' + SNo1++ + '</td>' +
                                                        '<td> <label id="lblColor">' + item.ColorDesc + ' </label><input type="hidden" id="hdnColorCode" value="' + item.ColorCode + '"/></td>' +
                                                        '<td> <label id="lblSalePrice">' + item.SalePrice + ' </label></td>' +
                                                        '<td> <label id="lblCostPrice">' + item.CostPrice + ' </label></td>' +
                                                        '<td> <label id="lblWHTax">' + item.WHTaxPerc + ' </label></td>' +
                                                        '<td> <label id="lblFurTax">' + item.FurTaxPerc + ' </label></td>' +
                                                        '<td> <label id="lblExTax">' + item.ExtraTaxPerc + ' </label></td>' +
                                                        '<td> <label id="lblRegType">' + item.RegType + ' </label></td>' +
                                                        '<td> <label id="lblRegTax">' + item.RegTaxPerc + ' </label></td>' +
                                                        '<td> <label id="lblChkActive">' + item.IsActive + ' </label></td>' +
                                                        '</td><td style="text-align:left"><a class="selectItem"><i class="fa fa-edit" style="color:blue"></i></a>&nbsp;&nbsp;|&nbsp;&nbsp;<a class= "deleteItem" style="color:blue" ><i class="fa fa-trash"></i></a></td></tr>');

                            });
                        }
                    }
                },
                complete: function () {
                    $('#VehicleModal').modal("hide");
                },
            });

        }

    }
    $("table#VehicleDetail").on('click', '.selectItem', function () {
        debugger

        rIndex = $(this).closest('tr');
        index = $(this).closest('tr')[0].rowIndex;
        debugger
        var colorcode = $(rIndex).closest('tr').find("#hdnColorCode").val();
        var colorDesc = $(rIndex).closest('tr').find("#lblColor").text().trim();
        var lblSalePrice = $(rIndex).closest('tr').find("#lblSalePrice").text().trim();
        var lblCostPrice = $(rIndex).closest('tr').find("#lblCostPrice").text().trim();
        var lblWHTax = $(rIndex).closest('tr').find("#lblWHTax").text().trim();
        var lblFurTax = $(rIndex).closest('tr').find("#lblFurTax").text().trim();
        var lblExTax = $(rIndex).closest('tr').find("#lblExTax").text().trim();
        var lblRegType = $(rIndex).closest('tr').find("#lblRegType").text().trim();
        var lblChkActive = $(rIndex).closest('tr').find("#lblChkActive").text().trim();
        var lblRegTax = $(rIndex).closest('tr').find("#lblRegTax").text().trim();
        $("#ddlColor").val(colorcode);
        $("#txtSalePrice").val(lblSalePrice);
        $("#txtCostPrice").val(lblCostPrice);
        $("#txtWHTax").val(lblWHTax);
        $("#txtFurTax").val(lblFurTax);
        $("#txtExTax").val(lblExTax);
        $("#ddlRegType").val(lblRegType);
        $("#txtRegTax").val(lblRegTax);

        if (lblChkActive == "Y")
        {
            $("#chkActive").is(":checked")

        }
        else {
            $("#chkActive").is(":unchecked");
        }
        $(this).closest('tr').remove();

    });

    $("table#VehicleDetail").on('click', '.deleteItem', function () {
        rIndex = $(this).closest('tr');
        index = $(this).closest('tr')[0].rowIndex;
        $(this).closest('tr').remove();

    });

    $("#ddlVehicleType").change(function () {
        debugger
        var type = $("#ddlVehicleType").val();


           getCategory(type);


    });

    @*function getCategory(id) {

        debugger
        var leadId = id;
        var dealerCode = "@Session["DealerCode"].ToString()";

        if (leadId != "0") {
            $.ajax({
                dataType: "json",
                async: true,
                type: 'GET',
                url: '@Url.Content("~/Vehicle/Select_VehicleCategory")',
                data: { 'EnquiryId': leadId, 'DealerCode': dealerCode },
                success: function (data) {
                    debugger
                    if (data.Success == true) {
                        //var items = JSON.parse(data.Response)

                        $("#txtVehCategory").val(data.Response);
                    }
                },
                complete: function () {

                },
            });
        }
    }*@

</script>
