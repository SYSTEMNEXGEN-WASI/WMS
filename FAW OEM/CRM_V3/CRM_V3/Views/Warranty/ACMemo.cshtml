
@{
    ViewBag.Title = "ACMemo";
    Layout = "~/Views/Shared/_LayoutV2.cshtml";
}

<h2>ACMemo</h2>

<link href='@Url.Content("~/assets/plugins/datatables/css/jquery.dataTables.css")' rel="stylesheet" />
<link href='@Url.Content("~/assets/plugins/datatables/css/jquery.dataTables.min.css")' rel="stylesheet" />
<link href='@Url.Content("~/assets/plugins/jquery-ui/smoothness/jquery-ui.min.css")' rel="stylesheet" type="text/css" media="screen" />
<link href='@Url.Content("~/assets/plugins/select2/select2.css")' rel="stylesheet" type="text/css" media="screen" />
<link href='@Url.Content("~/assets/plugins/select2/select2-bootstrap.css")' rel="stylesheet" type="text/css" media="screen" />
<link href='@Url.Content("~/assets/plugins/icheck/skins/minimal/blue.css")' rel="stylesheet" type="text/css" media="screen" />
@*<link href='@Url.Content("~/assets/css/chosen.css")' rel="stylesheet" type="text/css" />
    <link href='@Url.Content("~/assets/css/bootstrap-select.css")' rel="stylesheet" type="text/css" />*@
<link href="../assets/plugins/icheck/skins/all.css" rel="stylesheet" type="text/css" media="screen" />
<link href="../assets/plugins/icheck/skins/all.css" rel="stylesheet" type="text/css" media="screen" />

<link href='@Url.Content("~/assets/plugins/jquery-ui/smoothness/jquery-ui.min.css")' rel="stylesheet" type="text/css" media="screen" />
<link href='@Url.Content("~/assets/plugins/datepicker/css/datepicker.css")' rel="stylesheet" type="text/css" media="screen" />

<section class="wrapper main-wrapper row" style=''>

    <div class="clearfix"></div>
    <form method="post">
        <div class="col-xs-12">
            <section class="box">
                <header class="panel_header">
                    <h2 class="title pull-left">Approved Claim Memo Part </h2>
                    <div class="actions panel_actions pull-right">
                        <a class="box_toggle fa fa-chevron-down"></a>
                        @*<a class="box_setting fa fa-cog" data-toggle="modal" href="#section-settings"></a>*@
                    </div>
                </header>
                <div class="content-body">
                    <div class="row">
                        <div class="col-md-4 hidden">
                            <label class="form-label">Customer</label>
                            <div class="input-group">
                                <div class="input-group-addon"><a data-toggle="modal" data-target="#POModalSO" style="color:blue"><i class="fa fa-search"></i></a></div>
                                <input type="text" class="form-control" id="txtCustomer" readonly>
                            </div>
                            <input type="hidden" class="form-control" id="txtCustomerCd" readonly>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4">
                            <label>Dealer</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-th-list"></i></span>
                                @Html.DropDownList("ddlDealer", new SelectList((IEnumerable<SelectListItem>)ViewBag.Dealers, "Value", "Text", "0"), new { @class = "form-control m-bot15", @id = "ddlDealer" })
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4 hidden">
                            <label class="form-label">ItemCode</label>
                            <div class="input-group">
                                <span class="input-group-addon"><a id="IssueClick" onclick="ShowModal('ProductModal')" style="color:blue"><i class="fa fa-search"></i></a></span>
                                <input type="text" required class="form-control" id="txtItemCode" maxlength="250">
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4 hidden">
                            <label class="form-label">Item Description</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-car"></i></span>
                                <input type="text" required class="form-control" id="txtItemDesc" maxlength="250">
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Product</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-car"></i></span>
                                @*<input type="text" class="form-control" id="txtProduct" readonly />*@
                                @Html.DropDownList("ddlProdCode", new SelectList((IEnumerable<SelectListItem>)ViewBag.ProdCode, "Value", "Text", "0"), new { @class = "form-control m-bot15", @id = "ddlProdCode" })
                            </div>
                            <div class="makespace"></div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Vehicle Category</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-car"></i></span>
                                <input type="text" required class="form-control" id="txtType" value="@ViewBag.Heading" maxlength="250" readonly>
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4">
                            <label>Frome Date</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>@*@Html.EditorFor(model => model.DateofSale, new { @class = "form-control" })*@
                                @*<input type="text" class="form-control ui-datepicker" id="txtFromDate" readonly>*@
                                <input type="text" class="form-control datepicker" data-format="D, dd MM yyyy" value="" id="txtFromDate" readonly>
                            </div>
                            <div class="makespace"></div>
                        </div>
                        <div class="col-md-4">
                            <label>To Date</label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="text" class="form-control datepicker" id="txtToDate" readonly>
                            </div>
                            <div class="makespace"></div>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="pull-right">
                                <a class="btn btn-primary" id="btnPrint" href="#">Print</a>
                                <button type="reset" class="btn btn-default">Clear</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </form>
    <div class="modal" tabindex="-1" id="ProductModal" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="margin-top:60px;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="modal123Label">Product</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group row">
                        <label for="exampleInputuname" class="col-md-2">Search :</label>
                        <div class="col-md-10">
                            <input type="text" id="ProductSearch" class="form-control" aria-controls="ProductTable" placeholder="Search . . . ">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="table-responsive" style="height:350px;">
                            <table id="ProductTable" class="table table-striped table-hover responsive">
                                <thead>
                                    <tr>
                                        <th>SR No</th>
                                        <th>Item Code</th>
                                        <th>Item Description </th>
                                        <th>Purchase Rate</th>


                                    </tr>
                                </thead>

                                <tbody style="font-size:12px; text-transform: uppercase">

                                    @*@{ int i = 1; }
                                        @if (ViewBag.ddlProduct != null)
                                        {

                                            foreach (var item in ViewBag.ddlProduct)
                                            {

                                                <tr style="text-align: left" onclick="SelectVehicle('@item.VersionCode','@item.ProdCode','@item.ProdDesc','@item.ChasisNo','@item.EngineNo','@item.BrandCode','@item.BrandDesc','@item.ColorCode','@item.ColorDesc')">
                                                    <td class="tdDiv">
                                                        <a href="#" style="color:black">@item.VersionCode</a>
                                                    </td>
                                                    <td class="tdDiv">
                                                        <a href="#" style="color:black">@item.ProdCode</a>
                                                    </td>
                                                    <td class="tdDiv">
                                                        <a href="#" style="color:black">@item.ProdDesc</a>
                                                    </td>
                                                    <td class="tdDiv">
                                                        <a href="#" style="color:black">@item.ChasisNo</a>
                                                    </td>

                                                </tr>
                                            }
                                        }*@
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    @*<div class="modal" tabindex="-1" id="POModalSO" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content" style="margin-top:60px;">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="modal123Label">Customer Invoice Detail</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group row">
                            <label for="exampleInputuname" class="col-md-2">Search :</label>
                            <div class="col-md-10">
                                <input type="text" id="ProductSearchCus" class="form-control" aria-controls="ProductTable" placeholder="Search . . . ">
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="table-responsive" style="height:350px;">
                                <table id="ProductTableCus" class="table table-striped table-hover responsive">
                                    <thead>
                                        <tr>
                                            <th class="tdDiv" style="text-align:left" width:"30%">Customer Code</th>
                                            <th class="tdDiv" style="text-align:left" width:"30%">Customer</th>
                                            <th class="tdDiv" style="text-align:left" width:"30%">Contact</th>
                                            <th class="tdDiv" style="text-align:left" width:"30%">Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody style="font-size:12px; text-transform: uppercase">
                                        @if (ViewBag.Customer != null)
                                        {
                                            foreach (var item in ViewBag.Customer)
                                            {
                                                <tr style="text-align: left" onclick="RevClickSO('@item.CusCode','@item.CusDesc','@item.NIC','@item.CellNo','@item.Address1','@item.Balance')">
                                                    <td class="tdDiv">
                                                        <a href="#" style="color:black">@item.CusCode</a>
                                                    </td>
                                                    <td class="tdDiv">
                                                        <a href="#" style="color:black">@item.CusDesc</a>
                                                    </td>
                                                    <td class="tdDiv">
                                                        <a href="#" style="color:black">@item.CellNo</a>
                                                    </td>
                                                    <td class="tdDiv">
                                                        <a href="#" style="color:black">@item.Balance</a>
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger waves-effect text-left" data-dismiss="modal">Close</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>*@

</section>
<script src='@Url.Content("~/assets/js/jquery-1.11.2.min.js")' type="text/javascript"></script>
<script src='@Url.Content("~/assets/plugins/jquery-ui/smoothness/jquery-ui.min.js")' type="text/javascript"></script>



<script>
    $(document).ready(function () {
        ItemProduct();
        $(".datepicker").datepicker({
            dateFormat: "dd-mm-yy",
            yearRange: "-3:+1",
            changeYear: true,
            changeMonth: true,
        });

        $(function () {
            $(".datepicker").datepicker({
                changeYear: true,
                changeMonth: true,
                yearRange: "-30:+1",
                dateFormat: "dd-mm-yy"
            });
        });
    })
    RevClickSO = function (CusCode, CusDesc, CNICNTN, ContactNo, BillTo, Balance) {
        debugger

        document.getElementById('txtCustomerCd').value = CusCode;
        document.getElementById('txtCustomer').value = CusDesc;

        $("#POModalSO").modal("hide");
    }


    $(document).ready(function () {
        $("#ProductSearch").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#ProductTable tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });
    function ItemProduct() {

        debugger
        var rowCount = 1;
        var dataCount = 1;
        var cat = $("#txtType").val();

        var SNo = 1;

        var dealerCode = "@Session["DealerCode"].ToString()";

        $.ajax({
            dataType: "json",
            async: true,
            type: 'GET',
            url: '@Url.Content("~/FailedPartDetail/Select_ItemProduct")',
           data: { 'DealerCode' :'@Session["DealerCode"].ToString()','cat':cat},
            success: function (data) {

                if (data.Success == true) {

                    $("#ProductTable tbody tr").remove()
                    if (data.Response.length > 0) {
                        debugger
                        $.each(data.Response, function (value, data) {


                            var temp = '<tr id="DelChkListRow1' + (rowCount++) + '" data-tr-count="' + (dataCount++) + '" onclick="ProductSelect(this)">' +
                                '<td>' + SNo++ + '</td>' +
                                '<td class="tdDiv" style="overflow:auto"><label id="lblItemCode">' + data.ItemCode + '</label><input type="hidden" id="hdnBrandCode" value="' + data.ItemCode + '"/></td>' +
                          '<td class="tdDiv" style="overflow:auto"><label id="lblItemDesc">' + data.ItemDesc + '</label><input type="hidden" id="hdnProdCode" value="' + data.ItemCode + '"/></td>' +
                          '<td class="tdDiv" style="overflow:auto"><label id="lblPurchaseRate">' + data.PurchaseRate + '</label></td>' +

                            '</tr>';


                            $("#ProductTable tbody").append(temp);



                        });

                    }

                }
            },
            complete: function () {
                //if (tempProduct != "") {
                //    $("#ddlProdCode").val(tempProduct);
                //}

            },
        });

    }
    function ShowModal(type) {

        if (type == 'Receipt') {
            $('#VehRecModal').modal("show");
        } else if (type == 'Customer') {
            $('#CustomerModal').modal("show");
        } else {
            $('#ProductModal').modal("show");
        }
    }
    ProductSelect = function (value) {
        debugger

        var ItemCode = $(value).closest('tr').find("#lblItemCode").text();
        var ItemDesc = $(value).closest('tr').find('#lblItemDesc').text();
       // var PurchaseRate = $(value).closest('tr').find('#lblPurchaseRate').text();



        document.getElementById("txtItemCode").value = ItemCode;
        $("#txtItemCode").css("border-color", "#e1e1e1");
        document.getElementById("txtItemDesc").value = ItemDesc;
      //  document.getElementById("txtPurchaseRate").value = PurchaseRate;

        $("#ProductModal").modal("hide");
        $("#Product2wheelModal").modal("hide");

    }

    RevClickSO = function (CusCode, CusDesc, CNICNTN, ContactNo, BillTo, Balance) {
        debugger

        document.getElementById('txtCustomerCd').value = CusCode;
        document.getElementById('txtCustomer').value = CusDesc;

        $("#POModalSO").modal("hide");
    }



    $("#btnPrint").click(function () {

        var baseurl = '@Url.Action("ACMDetailExport")';
        var url = baseurl + '?dealerCode=' + $("#ddlDealer").val() + '&EnquiryId=' + $("#txtItemCode").val() + '&FromDate=' + $("#txtFromDate").val() + '&ToDate=' + $("#txtToDate").val() + '&Type=' + $("#txtType").val()+'&ProdCode='+$("#ddlProdCode").val();

        window.open(url, '_blank');

    })
</script>



